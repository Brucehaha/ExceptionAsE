{% extends 'site-layout.html' %}
{% block css %}

{% endblock %}

{% block content %}

<div class="article-item clearfix">
    <h2>{{ article.title }}</h2>
     <div class="article-sum my-2"> {{ article.summary }} </div>
    <div class="article-content">
    {{ article.articledetail.content|safe }}
    </div>


    <div class="article-info my-2">
        <a href="#">
            <i class="fa fa-user-o" aria-hidden="true"></i>
            <span>{{ blog.user.nickname }}</span>
        </a>
        <span>{{ article.create_time }}</span>

    </div>
        <div class="art-recommend clearfix">
            <div class="recommend">
                <a href="#" class="up"
                   style="margin: 5px 10px;display: inline-block;padding: 5px 15px;border: 1px solid #dddddd;text-align: center;">
                    <i class="fa fa-thumbs-o-up fa-3" aria-hidden="true" style="font-size: 25px"></i>

                    <div>{{ article.up_count }}</div>
                </a>
                <a href="#" class="down"
                   style="margin: 5px 30px 5px 10px;display: inline-block;padding: 5px 15px;border: 1px solid #dddddd;text-align: center;">
                    <i class="fa fa-thumbs-o-down fa-3" aria-hidden="true" style="font-size: 25px"></i>

                    <div>{{ article.down_count }}</div>
                </a>
            </div>
        </div>

    <div class="art-comment">
        <div class="comment-title">
            <span style="margin-right:10px">Comments</span>
        </div>
            <div class="comment">
               <a  href="#" class="ele">
                <i class="fa fa-commenting-o" aria-hidden="true"></i>
                <span> {{ article.comment_count }}</span>
            </a>

        </div>
        <div class="comment-list my-2">
            {% for comment in comment_list %}
            <div class="comment-item">
                <div class="reply-title clearfix">
                    <div class="user-info">
                        <span>{{ comment.user.nickname }}</span>
                        <span>{{ comment.created_time }}</span>
                    </div>
                    <div class="reply">
                        <a href="#">Reply</a>
                    </div>
                </div>
                <div class="reply-body">
                    {% if comment.reply %}
                    <div class="reply-user">@{{ comment.reply.user.nickname }}</div>
                    {% endif %}
                    <div class="content">
                        {{ comment.content|safe }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
{{ page_obj.pages }}
    </div>

    <div class="comment-area">

        <div class="replay-comment-user">
            <div class="reply-area" style="position: relative;">
                {% if not request.session.user_info or not request.user %}
                <div style="text-align:center;line-height:200px;position: absolute;top:0;left:0;right:0;bottom: 0;background-color: rgba(255,255,255,.6)">
                    Login to replay <a href="/account/login.html">Login</a> | <a href="/register.html">Register</a>
                </div>
                {% endif %}
                <textarea name="content" style="width: 100%;height:200px;"></textarea>
            </div>
            <div class="reply-btn">
                <span><span>21</span>/255 </span>
                <a href="javascript:void(0)" id="reply-submit" class="btn btn-primary submit">Submit</a>
            </div>
        </div>

    </div>
</div>
{% endblock %}
{% block js %}
    <script charset="utf-8" src="/static/plugins/kindeditor/kindeditor-all-min.js"></script>
    <script charset="utf-8" src="/static/plugins/kindeditor/lang/en.js"></script>
        <script>
        var editor;
        KindEditor.ready(function (K) {
            editor = K.create('textarea[name="content"]', {
                resizeType: 1,
                allowPreviewEmoticons: false,
                allowImageUpload: false,

                items: [
                    'fontname', 'fontsize', 'code', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',
                    'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                    'insertunorderedlist', '|', 'emoticons', 'image', 'link']
            });
        });
        function submitReply(){
            data={
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'content': editor.html(),
                'articleID': {{ article.nid }},
                'userID': [],
            }
            $.ajax(
                {
                    url:'/json/reply-comment',
                    type:'POST',
                    data: data,
                    dataType:'json',
                    success: function(args){
                        location.reload();
                    }
                }
            )
        }
        $('#reply-submit').on('click', function () {
            submitReply()
        })
    </script>
{% endblock %}